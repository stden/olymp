\begin{problem}{Мультиплексор}
{multiplexor.in}{multiplexor.out}
{2 секунды}{256 мегабайт}

Мультиплексор в TestSys --- это программа для одновременной организации контестов в разных местах
с использованием TestSys. Например, если в одно и то же время проходят тренировки в
Петергофе и Санкт-Петербурге, самый простой способ их организовать --- с помощью мультиплексора.
Тренировки по интернету тоже проводятся при помощи мультиплексора.

В этой задаче вам предстоит реализовать часть функциональности мультиплексора.
Программа должна прочитать конфигурационный файл и, далее, определить место назначения для каждого
входящего пакета.

Конфигурационный файл мультиплексора состоит из нескольких разделов. Описание каждого раздела
соответствует одному порту. Заголовок раздела состоит из одной строки вида:
\def\l{$\mathrm{<}$}
\def\r{$\mathrm{>}$}
\def\t#1{\texttt{#1}}
\def\m#1{\l\emph{#1}\r}
\def\c{$\mathtt{\cdot}$}

\t A\t\c\m{port}

где \m{port}\ --- произвольное целое число между 0 и $65\,535$, а
`\c' означает произвольное количество пробелов (ASCII-код 32) и табуляций (ASCII-код 9).
Для каждого порта определены некоторые правила. Описание каждого правила находится на отдельной
строке, выглядящей так:

\t F\c\m{from}\c\t T\c\m{to}[\c\t I\t\c\m{id list}][\c\t P\c\m{password}]

Квадратные скобки означают ``может быть опущено'', как и обычно. Параметр \m{from}\ 
может быть либо в форме \m{IP}\ , либо в форме\ \m{IP}\t/\m{mask}. В этой задаче \m{IP} 
всегда выглядит как \m{a}\t.\m{b}\t.\m{c}\t.\m{d}, где $a$, $b$, $c$ и $d$
--- любые целые числа в интервале $0..255$. \m{mask} --- это целое число между 0 и 32,
интерпретируется следующим образом. Каждый IP-адрес можно рассматривать как 32-битное двоичное число:
$a$ соответствует битам с 31 по 24 (старшие), $b$ --- битам с 23 по 16, $c$ --- с 15 по 8,
$d$ --- с 7 по 0 (младшие). Эти биты записаны в обычном порядке, то есть, например, старший бит $a$
является старшим битом всего числа, а младший бит $d$ является младшим битом всего числа.
Например, адрес 195.19.228.2 будет соответствовать двоичному числу
$11000011000100111110010000000010_2$=0xC313E402=3272860674 (или
$-1022106622$, если рассматривать знаковый тип). Значение маски определяет количество значимых
старших битов адреса. Остальные биты могут быть произвольными. Например, под
\texttt{195.19.228.2/24} подходит любой адрес, начинающийся на \texttt{195.19.228}
(``\texttt{195.19.228.*}''), а \texttt{195.19.228.2/20} означает, что адрес должен быть в интервале
\texttt{195.19.224.0}--\texttt{195.19.239.255}.
Если параметр \m{mask}\ опущен, маска считается равной 32 (все биты значимые). Пакет подходит под
правило, если источник пакета находится в указанном диапазоне.

Есть ещё три условия для того, чтобы пакет подошёл под правило. Во-первых, конечно, пакет должен
быть получен через порт \m{port},\ который указан в заголовке раздела. У всех разделов указаны
разные порты. Ещё два правила --- это правила соответствия идентификатора и пароля.
Правило соответствия пароля очень простое: пароль, содержащийся в правиле,
должен совпадать (с учётом регистра) с паролем к правилу (если правило не содержит пароля, любой принимается,
если в пакете нету пароля, он принимается только в случае отсутствия пароля у правила).
Пароль всегда состоит из не более, чем 64 букв и цифр.

Правило соответствия идентификатора несколько сложнее.
\m{id list}\ может иметь вид \m{id}\ или \m{firstid}\t-\m{lastid}. В первом случае необходимо
точное совпадение \m{id} и id, указанного в пакете (с теми же оговорками, что и в правиле
соответствия пароля, аналогично, идентификатор состоит из не более, чем 64 букв и цифр). 
Во втором случае \m{firstid}\ и \m{lastid} должны быть целыми числами одинаковой длины (ведущие нули разрешены).
Пакет удовлетворяет правилу, если идентификатор, указанный в пакете имеет ту же длину, что и \m{firstid} и \m{lastid},
является числом и лежит между \m{firstid} и \m{lastid} включительно. Длины этих чисел во входном файле никогда
не будут больше пяти.
%\renewcommand{\beforeproblemsectioncaption}{\smallbreak}

В случае, когда пакет удовлетворяет всем четырём условиям, он должен быть направлен хосту \m{to},
где \m{to}\ --- IP-адрес (\m{IP}). Правила проверяются в порядке их следования.
Как только найдено удовлетворяющееся правило, пакет немедленно перенаправляется и система переходит
к обработке следующего пакета.
Если пакет не подходит ни под одно правило, он перенаправляется в \emph{NULL device} (то есть игнорируется).

\InputFile

Входной файл начинается с нескольких строк, описывающих конфигурацию мультиплексора.
После последнего раздела идёт разделяющая строка, состоящая из трёх дефисов (``\texttt{{-}{-}{-}}'').
После этого начинаются пакеты. Пакеты описываются в том же виде, что и правила, с тремя исключениями:
во-первых, в адресе источника не разрешается маска (\m{mask}), во-вторых, адрес назначения отсутствует
(поскольку мы знаем, что этот пакет для нас), параметр \m{to}\ содержит номер порта, на который пришёл пакет,
в-третьих, идентификатор не может быть указан в виде диапазона (\m{firstid}\t-\m{lastid}).

В файле нет пустых строк. Количество разделов не менее одного и не более 32, и для каждого порта определено не
менее одного и не более 32 правил. Количество пакетов не превышает $3000$.

\OutputFile

Для каждого пакета выведите на отдельной строке адрес, на который его надо перенаправить.
Если пакет перенаправлен в \emph{NULL device}, выведите \texttt{/dev/null} вместо адреса.

\Example
\scriptsize
\exmpwidewid=0.97\thelinewidth
\begin{examplewide}%
\exmp{%
A       12345
F       192.168.64.90/24   T       195.19.228.2
F       195.19.228.2       T       192.168.64.90   I       00-29
A       13456
F       195.19.228.2/28    T       195.19.228.213  P       passwd
F       0.0.0.0/0          T       195.19.228.2    I       ttt     P       secret
A       23917
F       1.2.3.4            T       195.19.228.2    I       1
{-}{-}{-}
F       192.168.64.239     T       12345           I       abc
F       192.168.65.0       T       12345
F       195.19.228.2       T       12345           I       1
F       195.19.228.2       T       12345           I       23      P       super
F       1.2.3.4            T       23917           I       01
F       1.2.3.4            T       23917           I       1
F       1.2.3.4            T       23917
F       195.19.228.16      T       13456           P       passwd
F       195.19.228.16      T       13456           I       ttt     P       passwd
F       195.19.228.16      T       13456           I       ttt     P       secret
F       195.19.228.15      T       13456           P       passwd
F       195.19.228.15      T       13456           I       ttt     P       passwd
}{%
195.19.228.2
/dev/null
/dev/null
192.168.64.90
/dev/null
195.19.228.2
/dev/null
/dev/null
/dev/null
195.19.228.2
195.19.228.213
195.19.228.213
}%
\end{examplewide}%

\end{problem}
